function initGroupList(){if(getCookie("realname")){setGroupCount();var elem=$("#mwMyCollections");$(elem).empty();var a=document.createElement('a')
a.href="?request=favorites;lo=1";a.innerHTML="My Collections";$(elem).append(a);toggleMenuItems(true);}else{saveMWebCookie("collectionCount",-1);toggleMenuItems(false);}}
function toggleMenuItems(loggedIn){if(loggedIn){$("#co_menu_logout").removeClass("hidden");$("#co_menu_login").addClass("hidden");$("#co_menu_favorites").removeClass("hidden");}}
function getGroups(usr){var c=caller.replace("X",getSec()).replace("Y","0");var rn=(Math.random()*82739);$.get("/mwebcgi/mwebxml.exe?dsn=mwebprod;request=favorites;owner="+usr+";imgcount=4;caller="+c+";ts="+rn).success(function(data){var fv=$(data).find("favorites")[0];var cnt=$(fv).attr('count');var recs=$(fv).children("title");var y=0;var n=0;var s="";var ul=document.getElementById("faveGroups");$(ul).empty();for(var x=0;x<recs.length;x++){var nd=recs[x];var tnd=$(nd).children("title");var ind=$(nd).children("images");var rnd=$(nd).children("remarks");var cnd=$(nd).children("count");var ttl="";var cmt="";var thm="";var ncnt="";var listrowitem=document.createElement("list-row-item");listrowitem.setAttribute("_ngcontent-c17","");listrowitem.setAttribute("_nghost-c20","");var li=document.createElement("li");li.setAttribute("_ngcontent-c20","");li.className="root";listrowitem.appendChild(li);ul.appendChild(listrowitem);if(tnd.length>0){ttl=$(tnd).text();}
if(rnd.length>0){cmt=$(rnd).text();}
if(cnd.length>0){ncnt=$(cnd).text();}
var a=document.createElement("a");a.href="?request=favoriteitems;save="+ttl;a.setAttribute("_ngcontent-c20","");a.className="wrapper";a.title=ttl;li.appendChild(a);if(ind.length>0){var imgs=$(ind).children("image");var div=document.createElement("div");div.setAttribute("_ngcontent-c20","");div.className="thumbnails thumbnails-"+imgs.length;a.appendChild(div);for(var j=0;j<imgs.length;j++){var img=imgs[j];var poster=document.createElement("poster");poster.setAttribute("_ngcontent-c20","");poster.setAttribute("cover","");poster.setAttribute("_nghost-c13","");poster.className="poster-"+(j+1);var posterDiv=document.createElement("div");posterDiv.setAttribute("_ngcontent-c13","");posterDiv.className="p_wrapper";poster.appendChild(posterDiv);var posterImg=document.createElement("img");posterImg.src=$(img).text();posterImg.setAttribute("_ngcontent-c13","");posterImg.className="image";posterDiv.appendChild(posterImg);div.appendChild(poster);}}else{var div=document.createElement("div");div.setAttribute("_ngcontent-c20","");div.className="thumbnails thumbnails-1";a.appendChild(div);var poster=document.createElement("poster");poster.setAttribute("_ngcontent-c20","");poster.setAttribute("cover","");poster.setAttribute("_nghost-c13","");poster.className="poster-1";}
var textdiv=document.createElement("div");textdiv.setAttribute("_ngcontent-c20","");textdiv.className="ui-g";a.appendChild(textdiv);var ttldiv=document.createElement("div");ttldiv.innerHTML=ttl+" ("+ncnt+")";textdiv.appendChild(ttldiv);var remdiv=document.createElement("div");remdiv.innerHTML=cmt;textdiv.appendChild(remdiv);}});}
function setGroupCount(){var c=caller.replace("X",getSec()).replace("Y","0");var rn=(Math.random()*82739);var usr=getCookie("user");if(usr!=null){$.get("/mwebcgi/mwebxml.exe?dsn=mwebprod;request=favorites;owner="+usr+";caller="+c+";ts="+rn).success(function(data){var cnt=$(data).find("favorites").attr('count');saveMWebCookie("collectionCount",cnt);});}else{saveMWebCookie("collectionCount",-1);}}
function selectCollection(){var cnt=getCookie("collectionCount");if(cnt<0){alert("You must sign in or create an account\r\nbefore you can save items to a collection.\r\nTo do so, click the Sign in/Register link in the menu.");}else if(cnt==0){$('#mw-new-collection').show();}else{setGroupList();$('#mw-add-item').show();}}
function submitNewItem(){var id=getParam("id");var type=getParam("type");var usr=getCookie('user');document.additemform.owner.value=getParam("owner");document.additemform.id.value=getParam("id");document.additemform.type.value=getParam("type");document.additemform.submit();}
function addNewCollection()
{$("#mw-new-collection").show();}
function submitNewCollection(){var usr=getCookie("user");var ttl=document.getElementById("newtil").value;if(ttl==null||ttl==""){ttl=alert("Enter the name of the new collection!");return false;}
var rem=document.getElementById("newrem").value;if(ttl){$.post("/mwebcgi/mweb.exe",{request:"favorites",owner:usr,newtil:ttl,newrem:rem}).done(function(){saveMWebCookie('title',ttl);saveMWebCookie('save',ttl);$("#mw-new-collection").hide();getGroups(usr);});}
return false;}
function editGroup(ttl){if(ttl==null||ttl==""){return;}else{var newWin=open('/editFavorite.html?title='+ttl,'pop','height=510,width=510,top=20,left=270,screenY=20,screenX=270,toolbar=no,scrollbars=1,location=0,menu=1');newWin.focus();}}
function setGroupList(){var c=caller.replace("X",getSec()).replace("Y","0");var usr=getCookie('user');var nm=getCookie("realname");var elem=document.getElementById("myFavorites");if(nm==null||nm==""||elem==null){return true;}
var curGrp=unescape(getParam("save"));if(curGrp==null){curGrp=="";}
if(curGrp==""){curGrp=unescape(getCookie('save'));}
if(curGrp==""){curGrp=unescape(getCookie('title'));}
$(elem).empty();$.get("/mwebcgi/mwebxml.exe?dsn=mwebprod;request=favorites;owner="+usr+";caller="+c).success(function(data){var fv=$(data).find("favorites");var recs=$(fv).children("title");for(var i=0;i<recs.length;i++){var nd=recs[i];var tnd=$(nd).children("title");if(tnd.length>0){var ttl=tnd.text();if(curGrp==""){curGrp=ttl;saveMWebCookie("save",escape(ttl));saveMWebCookie("title",escape(ttl));}else if(curGrp==ttl){sel=" selected";}else{sel="";}
var option=document.createElement("option");option.value=ttl;option.innerHTML=ttl+" ("+$(nd).children("count").text()+")";elem.appendChild(option);}}
var option=document.createElement("option");option.value="";option.innerHTML="Add to a new collection";elem.appendChild(option);});}
function doGroupCheck(elem){var arr=document.additemform.elements;if(elem.name=="alltitles"){if(elem.checked){for(var i=0;i<arr.length;i++){var el=arr[i];if(el.name=="title"){el.checked=elem.checked;}}}}else{var all=document.getElementById("alltitles");if(!elem.checked){all.checked=false;}else{var allchecked=true;for(var i=0;i<arr.length;i++){var el=arr[i];if(el.name=="title"&&!el.checked){allchecked=false;break;}}
all.checked=allchecked;}}}
function toggleSaveBtn(itm,key){if(itm.className=="submitAdd"){saveItem(key,1);}else{removeItem(key,1);}}
function toggleSaveItem(itm){if(itm.checked){saveItem(itm.name,0);}else{removeItem(itm.name,0);}}
function removeItem(itm,fr){var usr=getCookie("user");var ttl=document.getElementById("myFavorites").value;if(ttl){var dataString="request=delfave;owner="+usr+";title="+ttl+";key="+itm;$.ajax({type:"POST",url:"/mwebcgi/mweb.exe",data:dataString,success:function(){console.log("/mwebcgi/mweb.exe?"+dataString);setGroupList("");if(fr==1){highlightGroupDetail(ttl,itm);}}});}
return false;}
function saveItem(itm,fr){var usr=getCookie("user");var ttl=document.getElementById("myFavorites").value;if(ttl==null||ttl==""){ttl=prompt("Enter the name of the new group:");}
if(ttl){var dataString="request=favorites;setSave=1;owner="+usr+";title="+ttl+";key="+itm;$.ajax({type:"POST",url:"/mwebcgi/mweb.exe",data:dataString,success:function(){console.log("/mwebcgi/mweb.exe?"+dataString);saveMWebCookie('title',ttl);saveMWebCookie('save',ttl);setGroupList("");if(fr==1){highlightGroupDetail(ttl,itm);}}});}
return false;}
function saveItems(str){var usr=getCookie("user");var ttl=document.getElementById("myFavorites").value;if(ttl==null||ttl==""){ttl=prompt("Enter the name of the new group:");}
if(ttl){var itms=str.split(";");for(var i=0;i<itms.length;i++){if(itms[i]!=""){var dataString="request=favorites;setSave=1;owner="+usr+";title="+ttl+";key="+itms[i];$.ajax({type:"POST",url:"/mwebcgi/mweb.exe",data:dataString,success:function(){console.log("/mwebcgi/mweb.exe?"+dataString);}});}}
setGroupList("");}
return false;}
function removeItems(str){var usr=getCookie("user");var ttl=document.getElementById("myFavorites").value;if(ttl){var itms=str.split(";");for(var i=0;i<itms.length;i++){if(itms[i]!=""){var dataString="request=delfave;owner="+usr+";title="+ttl+";key="+itms[i];$.ajax({type:"POST",url:"/mwebcgi/mweb.exe",data:dataString,success:function(){console.log("/mwebcgi/mweb.exe?"+dataString);}});}}}
return false;}
function highlightGroupItems(ttl){if(ttl){saveMWebCookie("title",ttl);saveMWebCookie("save",ttl);var elem=document.getElementById('backColl');if(elem){elem.innerHTML="<a href=\"?request=favoriteitems;title="+ttl+"\" id=\"collLink\">View "+ttl+"</a>";}}
var c=caller.replace("X",getSec()).replace("Y","0");var usr=getCookie('user');var keys="";if(usr==""){return;}
$("#searchResultsTargetWrapper :input[type=checkbox]").each(function(event){keys+=(","+this.name);$(this).attr('class','notFave');$(this).prop('checked',false);});keys=keys.substring(1);$.get("/mwebcgi/mwebxml.exe?dsn=mwebprod;request=member;owner="+usr+";title="+ttl+";keys="+keys+";caller="+c).success(function(data){var recs=$(data).find("key");for(var i=0;i<recs.length;i++){var nm='[name="'+$(recs[i]).text()+'"]';$(nm).attr('class','fave');$(nm).prop('checked',true);}});}
function highlightGroupDetail(ttl,keys){if(ttl){saveMWebCookie("title",ttl);saveMWebCookie("save",ttl);var elem=document.getElementById('backColl');if(elem){elem.innerHTML="<a href=\"?request=favoriteitems;save="+ttl+"\" id=\"collLink\">View "+ttl+"</a>";}}
var c=caller.replace("X",getSec()).replace("Y","0");var usr=getCookie('user');if(usr==""||keys==""){return;}
var btn=document.getElementById("submitFaveBtn");$.get("/mwebcgi/mwebxml.exe?dsn=mwebprod;request=member;owner="+usr+";title="+ttl+";keys="+keys+";caller="+c).success(function(data){var fv=$(data).find("key");if(fv.length>0){$("#submitFaveBtn").attr('class','submitRemove');$("#submitFaveBtn").attr('value','Remove');}else{$("#submitFaveBtn").attr('class','submitAdd');$("#submitFaveBtn").attr('value','Add');}});}
function newFave(usr){if(usr==''){usr=getCookie('user');}
if(usr==''){return;}
var newWin=open('/createFavorite.html?owner='+usr,'pop','height=510,width=510,top=20,left=270,screenY=20,screenX=270,toolbar=no,scrollbars=1,location=0,menu=1');newWin.focus();}
function getParam(sname)
{var params=location.search.substr(location.search.indexOf("?")+1);var sval="";params=params.split(";");for(var i=0;i<params.length;i++)
{temp=params[i].split("=");if([temp[0]]==sname){sval=temp[1];}}
return sval;}
function remove(ttl,id,rectype,status)
{if(status==1){document.mainform.title.value=ttl;document.mainform.id.value=id;document.mainform.type.value=rectype;document.mainform.owner.value=getParam("owner");document.mainform.submit();}}
function removeFave(elem)
{if(elem){document.mainform.title.value=getParam("save");document.mainform.id.value=$(elem).attr("id");document.mainform.type.value=$(elem).attr("rectype");document.mainform.owner.value=getParam("owner");document.mainform.submit();}}
function getGroupList_formenu(fn,elem){var usr=getCookie('user');if(elem!=null){if(fn!=""){elem.innerHTML="<a href='?request=favorites;lo=1'>My collections</a>";document.getElementById('co_menu_logout').innerHTML="<a href='?request=logon'>Sign out</a>";setGroupList_formenu(usr,elem);}else{elem.innerHTML="<a href='?request=logonform'>Sign in/Register</a>";}}}
function getGroupItems(owner,ttl,divId){var c=caller.replace("X",getSec()).replace("Y","0");var elem=document.getElementById(divId);var sess=getCookie("user");var mf=$("#myFavorites");if(mf.length>0){mf.val(ttl);}
$.get("/mwebcgi/mwebxml.exe?dsn=mwebprod;request=favorites;owner="+owner+";title="+ttl+";number=200;caller="+c).success(function(data){var xml=$(data).find("favorites");var recs=$(xml).find("record");var cnt=$(xml).attr("count");var title=$(xml).attr("title");var cmt=$(xml).attr("remarks");if(recs==null||recs.length<1){return;}
var ul=document.createElement("ul");elem.appendChild(ul);$("#tli").html(title+" ("+cnt+")");if(cmt.length>0){$("#tlc").html(cmt);}
var x=0;var y=0;var n=0;var oldtxt="";var rec;var keys="";for(var n=0;n<recs.length;n++){rec=recs[n];var id=$(rec).attr("id");var tp=$(rec).attr("type");var key=$(rec).attr("key");var img=$(rec).find("thumbnail");var dsc=$(rec).find("descriptor");var dsctxt="";if(dsc.length>0){dsctxt=$(dsc).text();}
var culture=$(rec).children("Culture");var maker=$(rec).children("Artist___Maker");var dt=$(rec).children("Date");var accno=$(rec).children("Accession_No\\.");var ttl=$(rec).children("Title");var med=$(rec).children("Medium");var place=$(rec).children("Period___Movement");var href="?request=record;id="+id+";type="+tp;var li=document.createElement("li");li.className="searchResultsRow object";ul.appendChild(li);var imgdiv=document.createElement("div");imgdiv.className="searchResultsRowImage";li.appendChild(imgdiv);var img_a=document.createElement("a");img_a.className="floatLeftNoPad";img_a.onclick=function(){goLink(this);return false;};imgdiv.appendChild(img_a);var ti=document.createElement("img");if(img.length>0){ti.src=$(img).text();ti.className="thumbImage";ti.setAttribute("title",dsctxt);}else{ti.src="/mwebimages/thumbnails/noimage.jpg";ti.className="noImage";ti.setAttribute("hidden",true);}
img_a.appendChild(ti);var txtdiv=document.createElement("div");txtdiv.className="searchResultsRowInner";li.appendChild(txtdiv);if(maker.length>0){var div2=document.createElement("div");div2.className="noWrap listMaker";div2.innerHTML=$(maker).text();txtdiv.appendChild(div2);}
var div1=document.createElement("div");div1.className="noWrap";var span1=document.createElement("span");span1.className="listTitle";span1.innerHTML=$(ttl).text();div1.appendChild(span1);if(dt.length>0){var span2=document.createElement("span");span2.className="listDate";span2.innerHTML=$(dt).text();div1.appendChild(span2);}
txtdiv.appendChild(div1);if(culture.length>0){var div2=document.createElement("div");div2.className="listItem";div2.innerHTML=$(culture).text();txtdiv.appendChild(div2);}
if(place.length>0){var div2=document.createElement("div");div2.className="listItem";div2.innerHTML=$(place).text();txtdiv.appendChild(div2);}
if(med.length>0){var div2=document.createElement("div");div2.className="listItem";div2.innerHTML=$(med).text();txtdiv.appendChild(div2);}
if(accno.length>0){var div2=document.createElement("div");div2.className="listItem";div2.innerHTML=$(accno).text();txtdiv.appendChild(div2);}
console.log(sess+":"+owner);if(sess==owner){var div2=document.createElement("div");div2.className="fav-check";var del=document.createElement("input");del.setAttribute("type","checkbox");del.setAttribute("checked",true);del.className="fave";del.name=key;del.onclick=function(){toggleSaveItem(this);}
div2.appendChild(del);txtdiv.appendChild(div2);}
var clear=document.createElement("div");clear.className="clearfix";li.appendChild(clear);}
return;});}
function displayPublicFaves(letter){var c=caller.replace("X",getSec()).replace("Y","0");var xmlhttp;var rn=(Math.random()*82739);if(window.XMLHttpRequest)
{xmlhttp=new XMLHttpRequest();}
else
{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");}
xmlhttp.open("GET","/mwebcgi/mwebxml.exe?dsn=mwebprod;request=favorites;owner=public;imgcount=4;letter="+letter+";caller="+c+";ts="+rn,true);xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){xmlDom=xmlhttp.responseXML;var fv=xmlDom.getElementsByTagName("favorites")[0];var cnt=fv.getAttribute('count');var recs=fv.childNodes;var x=0;var y=0;var n=0;var thm="";var s="";while(x<cnt){var nd=recs[x];var tnd=nd.getElementsByTagName("title")[0];var ind=nd.getElementsByTagName("images")[0];var rnd=nd.getElementsByTagName("owner")[0];var cnd=nd.getElementsByTagName("count")[0];var ttl="";thm="";if(tnd.childNodes[0]!=null){ttl=tnd.childNodes[0].nodeValue;var usr="";if(rnd.childNodes[0]!=null){usr=rnd.childNodes[0].nodeValue;}
var gcnt="0";if(cnd.childNodes[0]!=null){gcnt=cnd.childNodes[0].nodeValue;}
if(ind!=null&&ind.childNodes[0]!=null){thm="";var imgs=ind.childNodes;var icnt=imgs.length;if(icnt>2){for(var j=0;j<icnt;j++){thm+="<div class='groupImage'><img class='groupthm' src='"+imgs[j].childNodes[0].nodeValue+"'></div>";}}else{thm="<div class='groupImage'><img class='groupthm' src='"+imgs[0].childNodes[0].nodeValue+"'></div>";thm+="<div class='groupImage'><img class='groupthm' src='/mwebgraphics/noimage.jpg'></div>";thm+="<div class='groupImage'><img class='groupthm' src='/mwebgraphics/noimage.jpg'></div>";if(icnt==2){thm+="<div class='groupImage'><img class='groupthm' src='"+imgs[1].childNodes[0].nodeValue+"'></div>";}}}else{for(var j=0;j<4;j++){thm+="<div class='groupImage'><img class='groupthm' src='/mwebgraphics/noimage.jpg'></div>";}}
s+="<LI class=\"searchResultsRow object\"><div class=searchResultsRowImage>"+"<A class=floatLeftNoPad href=\"?request=favoriteitems;owner="+usr+";save="+ttl+"\">"+thm+"</A>"+"</div>  <DIV class=searchResultsRowInner>"+"<A class=floatLeftNoPad href=\"?request=favoriteitems;owner="+usr+";save="+ttl+"\">"+ttl+"</a> ("+gcnt+")"+"</DIV></LI>";}
x++;}
document.getElementById("faveGroups").innerHTML=s;}}
xmlhttp.send();}
function getGroupDetails(ttl){var c=caller.replace("X",getSec()).replace("Y","0");var xmlhttp;var usr=getCookie('user');if(usr==""){return;}
if(window.XMLHttpRequest)
{xmlhttp=new XMLHttpRequest();}
else
{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");}
xmlhttp.open("GET","/mwebcgi/mwebxml.exe?dsn=mwebprod;request=favorites;owner="+usr+";title="+ttl+";details=1;caller="+c,true);xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){xmlDom=xmlhttp.responseXML;var fv=xmlDom.getElementsByTagName("favorites")[0];var cnt=fv.getAttribute('count');var recs=fv.childNodes;var x=0;var y=0;var n=0;var oldtxt="";var thm="";var s="";if(cnt>0){var nd=recs[x];var tnd=nd.getElementsByTagName("title")[0];var pnd=nd.getElementsByTagName("public")[0];var rnd=nd.getElementsByTagName("remarks")[0];var ttl="";if(tnd.childNodes[0]!=null){ttl=tnd.childNodes[0].nodeValue;var cmt="";if(rnd.childNodes[0]!=null){cmt=rnd.childNodes[0].nodeValue;}
var pub="";if(pnd.childNodes[0]!=null){pub=pnd.childNodes[0].nodeValue;}}}
document.getElementById("origtitle").value=ttl;document.getElementById("chgtil").value=ttl;document.getElementById("chgrem").value=cmt;document.getElementById("chgpub").checked=(pub=="yes");document.getElementById("origpub").value=(pub=="yes"?"true":"false");}}
xmlhttp.send();}
function setGroupList_formenu(usr,elem){var c=caller.replace("X",getSec()).replace("Y","0");var rn=(Math.random()*82739);var xmlhttp;if(usr==""){usr=getCookie('user');}
var curGrp=getCookie('save');if(usr==""){return;}
var ul=document.createElement("ul");elem.appendChild(ul);var stxt="<a href=# onclick=\"newFave('"+usr+"');\">"+"Create new collection</a>";var cli=document.createElement("li");cli.innerHTML=stxt;ul.appendChild(cli);var s="";$.get("/mwebcgi/mwebxml.exe?dsn=mwebprod;request=favorites;owner="+usr+";caller="+c+";ts="+rn).success(function(data){console.log(data);var fv=data.find("favorites");var recs=$(fv).children("Title");cnt=recs.length;var y=0;var n=0;var oldtxt="";var thm="";if(cnt>0){for(var x=0;x<cnt;x++){var nd=recs[x];var ttl="";if(nd.length>0){ttl=$(nd).children("Title").text();var li=document.createElement("li");ul.appendChild(li);var a=document.createElement("a");a.href="?request=favoriteitems;save="+ttl;if(ttl==curGrp){a.className="mw-current-group";}
a.append(document.createTextNode(ttl+" ("+$(nd).find("count").text()+")"));li.appendChild(a);}}}
ul.appendChild(cli);var btn=document.getElementById("faveSaveBtn");if(btn!=null){btn.onclick=function(){selectCollection(cnt);};}});}